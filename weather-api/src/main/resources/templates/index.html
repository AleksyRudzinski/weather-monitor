<!DOCTYPE html>
<html lang="pl" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Weather Monitor</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        :root { --card-radius: 18px; }

        body { background: radial-gradient(1200px 600px at 20% 0%, rgba(13,110,253,.10), transparent 60%),
        radial-gradient(900px 500px at 90% 10%, rgba(25,135,84,.10), transparent 55%),
        #f8f9fa; }

        .nav-blur {
            backdrop-filter: blur(10px);
            background: rgba(255,255,255,.75);
            border-bottom: 1px solid rgba(0,0,0,.06);
        }

        .hero {
            border-radius: 26px;
            background: linear-gradient(135deg,
            rgba(13,110,253,.14),
            rgba(25,135,84,.10));
            border: 1px solid rgba(0,0,0,.06);
        }

        .pill {
            border: 1px solid rgba(0,0,0,.08);
            border-radius: 999px;
        }

        .muted-mini { color: rgba(0,0,0,.58); font-size: .92rem; }
        .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }

        .city-card {
            border-radius: var(--card-radius);
            border: 1px solid rgba(0,0,0,.08);
            background: rgba(255,255,255,.92);
            box-shadow: 0 10px 30px rgba(0,0,0,.06);
        }
        .city-card:hover {
            transform: translateY(-2px);
            transition: 140ms ease;
            box-shadow: 0 16px 40px rgba(0,0,0,.08);
        }

        .temp {
            font-size: 2.4rem;
            font-weight: 700;
            letter-spacing: -0.02em;
            line-height: 1;
        }

        .desc {
            display: inline-flex;
            align-items: center;
            gap: .5rem;
            padding: .35rem .6rem;
            border-radius: 12px;
            border: 1px solid rgba(0,0,0,.07);
            background: rgba(0,0,0,.02);
        }

        .soft-divider {
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(0,0,0,.10), transparent);
            margin: 14px 0;
        }

        .btn-soft {
            border-radius: 12px;
            border: 1px solid rgba(0,0,0,.08);
            background: rgba(255,255,255,.9);
        }
        .btn-soft:hover { background: #fff; }

        .search-wrap {
            border-radius: 14px;
            border: 1px solid rgba(0,0,0,.08);
            background: rgba(255,255,255,.85);
        }
    </style>
</head>

<body>

<nav class="navbar nav-blur sticky-top">
    <div class="container py-2">
        <div class="d-flex align-items-center gap-2">
            <span class="fs-4">üå§Ô∏è</span>
            <div class="fw-semibold fs-5">Weather Monitor</div>
        </div>

        <div class="d-flex gap-2 align-items-center">
            <span class="badge text-bg-success pill px-3 py-2">OpenWeather</span>
            <span class="badge text-bg-primary pill px-3 py-2">Scheduler ON</span>
            <span class="badge text-bg-dark pill px-3 py-2">
                History limit: <span th:text="${historyLimit}">100</span>
            </span>
        </div>
    </div>
</nav>

<main class="container my-4">

    <!-- HERO -->
    <div class="hero p-4 p-md-5 shadow-sm mb-4">
        <div class="row align-items-center g-3">
            <div class="col-md-8">
                <h1 class="display-6 fw-semibold mb-2">Panel monitorowania pogody</h1>
                <p class="lead mb-1">
                    Wybierz miasto i podejrzyj <span class="fw-semibold">aktualnƒÖ pogodƒô</span> oraz <span class="fw-semibold">historiƒô pomiar√≥w</span>.
                </p>
                <div class="muted-mini">
                    Dane od≈õwie≈ºajƒÖ siƒô automatycznie w tle. ≈πr√≥d≈Ço: <span class="mono">OPENWEATHER</span>
                </div>
            </div>

            <div class="col-md-4 text-md-end">
                <div class="d-inline-flex flex-column gap-2">
                    <div class="badge text-bg-light pill px-3 py-2">
                        Liczba miast: <span class="fw-semibold" th:text="${citiesCount}">0</span>
                    </div>
                    <div class="badge text-bg-light pill px-3 py-2">
                        Interwa≈Ç: <span class="fw-semibold" th:text="${refreshInterval}">600000</span> ms
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- TOOLBAR -->
    <div class="row g-3 align-items-center mb-3">
        <div class="col-md-7">
            <div class="search-wrap p-2 shadow-sm">
                <div class="input-group">
                    <span class="input-group-text bg-transparent border-0">üîé</span>
                    <input id="citySearch" type="text" class="form-control border-0 bg-transparent"
                           placeholder="Szukaj miasta po nazwie / kodzie kraju / ID...">
                </div>
            </div>
        </div>
        <div class="col-md-5 text-md-end">
            <a class="btn btn-soft me-2" th:href="@{/h2-console}" target="_blank">H2 Console</a>
            <a class="btn btn-outline-primary" th:href="@{/api/cities}" target="_blank">API: cities</a>
        </div>
    </div>

    <!-- GRID -->
    <div class="row g-3" id="citiesGrid">

        <div class="col-12" th:if="${#lists.isEmpty(cities)}">
            <div class="alert alert-warning shadow-sm">
                Brak miast w bazie. Dodaj miasto przez <span class="mono">POST /api/cities</span>.
            </div>
        </div>

        <div class="col-md-6 col-lg-4" th:each="city : ${cities}">
            <div class="city-card p-3 h-100 city-card-item">
                <!-- header -->
                <div class="d-flex justify-content-between align-items-start gap-2">
                    <div>
                        <div class="fw-semibold fs-5 city-name" th:text="${city.name}">Warszawa</div>
                        <div class="muted-mini">
                            <span class="mono">ID:</span> <span class="mono city-id" th:text="${city.cityId}">1</span>
                            ¬∑ <span class="mono city-cc" th:text="${city.countryCode}">PL</span>
                        </div>
                    </div>

                    <span class="badge text-bg-light pill px-3 py-2">
                        üìç <span th:text="${city.latitude}">0</span>, <span th:text="${city.longitude}">0</span>
                    </span>
                </div>

                <div class="soft-divider"></div>

                <!-- weather section -->
                <div th:if="${city.temperature != null}">
                    <div class="d-flex justify-content-between align-items-end">
                        <div>
                            <div class="temp">
                                <span th:text="${#numbers.formatDecimal(city.temperature, 1, 1)}">0.0</span>¬∞C
                            </div>
                            <div class="muted-mini">
                                Odczuwalna: <span th:text="${#numbers.formatDecimal(city.feelsLikeTemperature, 1, 1)}">0.0</span>¬∞C
                            </div>
                        </div>

                        <div class="desc">
                            <span>üìù</span>
                            <span th:text="${city.weatherDescription}">clear sky</span>
                        </div>
                    </div>

                    <div class="mt-2 muted-mini">
                        üíß <span th:text="${city.humidity}">0</span>% ¬∑ üå¨Ô∏è <span th:text="${#numbers.formatDecimal(city.windSpeed, 1, 1)}">0.0</span> m/s
                    </div>

                    <div class="mt-1 muted-mini">
                        ‚è± pomiar: <span class="mono" th:text="${city.measuredAt}">-</span>
                    </div>
                </div>

                <div th:if="${city.temperature == null}" class="alert alert-warning py-2 mb-0">
                    Brak danych pogodowych. Poczekaj na scheduler albo zr√≥b refresh przez API.
                </div>

                <div class="soft-divider"></div>

                <!-- actions -->
                <div class="d-grid gap-2">

                    <!-- MVC refresh -->
                    <form th:action="@{/ui/cities/{id}/refresh(id=${city.cityId})}" method="post" class="d-grid">
                        <button type="submit" class="btn btn-soft" style="border-radius: 14px;">
                            üîÑ Od≈õwie≈º teraz
                        </button>
                    </form>

                    <a class="btn btn-primary" style="border-radius: 14px;"
                       th:href="@{/ui/cities/{id}(id=${city.cityId})}">
                        Otw√≥rz szczeg√≥≈Çy
                    </a>

                    <div class="btn-group" role="group" aria-label="API Links">
                        <a class="btn btn-outline-dark"
                           th:href="@{/api/cities/{id}/weather/latest(id=${city.cityId})}"
                           target="_blank">
                            Latest (API)
                        </a>
                        <a class="btn btn-outline-dark"
                           th:href="@{/api/cities/{id}/weather/history(id=${city.cityId},limit=50)}"
                           target="_blank">
                            History (API)
                        </a>
                    </div>

                    <div class="muted-mini">
                        Tip: refresh rƒôczny ‚Üí <span class="mono">POST /api/cities/{id}/weather/refresh</span>
                    </div>
                </div>


                <!-- footer -->
                <div class="d-flex justify-content-between muted-mini mt-3">
                    <span>≈πr√≥d≈Ço: <span class="mono">OPENWEATHER</span></span>
                    <span class="mono">v1</span>
                </div>
            </div>
        </div>
    </div>

    <div class="text-center muted-mini mt-4">
        Weather Monitor ‚Äî Spring Boot + Thymeleaf ¬∑ UI minimal (zaliczeniowo)
    </div>

</main>

<script>
    // proste filtrowanie po nazwie / countryCode / ID (frontend-only)
    const input = document.getElementById('citySearch');
    const grid = document.getElementById('citiesGrid');

    input?.addEventListener('input', () => {
        const q = input.value.trim().toLowerCase();
        const cards = grid.querySelectorAll('.city-card-item');

        cards.forEach(card => {
            const name = card.querySelector('.city-name')?.textContent?.toLowerCase() || '';
            const cc = card.querySelector('.city-cc')?.textContent?.toLowerCase() || '';
            const id = card.querySelector('.city-id')?.textContent?.toLowerCase() || '';
            const ok = name.includes(q) || cc.includes(q) || id.includes(q);

            // kolumna to parent (.col-...)
            card.parentElement.style.display = ok ? '' : 'none';
        });
    });
</script>

</body>
</html>
